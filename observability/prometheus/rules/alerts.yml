groups:
  - name: pipeline_alerts
    rules:
      - alert: ProducerDown
        expr: up{job="producer"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: Event producer is down
          description: The event producer has been unreachable for more than 1 minute.

      - alert: ProcessorDown
        expr: up{job="processor"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: Stream processor is down
          description: The stream processor has been unreachable for more than 1 minute.

      - alert: HighConsumerLag
        expr: sum(processor_consumer_lag) > 1000
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High consumer lag detected
          description: Consumer lag has exceeded 1000 messages for more than 5 minutes.

      - alert: ProcessingErrors
        expr: rate(processor_consume_errors_total[5m]) > 0.1
        for: 2m
        labels:
          severity: warning
        annotations:
          summary: Processing errors detected
          description: Processing error rate is above 0.1 per second.

      - alert: DatabaseWriteErrors
        expr: rate(processor_db_write_errors_total[5m]) > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: Database write errors detected
          description: Database write errors are occurring.

      - alert: HighPublishLatency
        expr: histogram_quantile(0.95, rate(producer_publish_latency_seconds_bucket[5m])) > 0.5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: High publish latency
          description: 95th percentile publish latency is above 500ms.

      - alert: NoEventsProduced
        expr: rate(producer_events_total[5m]) == 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: No events being produced
          description: No events have been produced in the last 5 minutes.

      - alert: NoEventsConsumed
        expr: rate(processor_events_consumed_total[5m]) == 0 and rate(producer_events_total[5m]) > 0
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: No events being consumed
          description: Events are being produced but not consumed.

